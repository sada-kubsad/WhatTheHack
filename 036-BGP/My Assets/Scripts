Show Effective Routes on VMs: 
az network nic show-effective-route-table -g $rg -o table -n testvm1359
az network nic show-effective-route-table  -g $rg -o table -n testvm2396
az network nic show-effective-route-table  -g $rg -o table -n  testvm3162 
az network nic show-effective-route-table  -g $rg -o table -n  testvm4402 
az network nic show-effective-route-table  -g $rg -o table -n testvm528 


On-Prem:
az network nic show-effective-route-table  -g $rg -o table -n csr3-nvaVMNic
az network nic show-effective-route-table  -g $rg -o table -n csr4-nvaVMNic
az network nic show-effective-route-table  -g $rg -o table -n csr5-nvaVMNic



CSR3:
-----
IP Address: 20.223.210.193
Address Spaces: 10.3.0.10/32
Changes needed to ssh into csr: https://www.petenetlive.com/kb/article/0001245
Also works:
ssh labadmin@20.223.210.193 -oHostKeyAlgorithms=+ssh-rsa -oKexAlgorithms=+diffie-hellman-group14-sha1


Start All VMs:
--------------
az vm start  -g wthbgp -n testvm1   > /dev/null 2>&1 & 
az vm start  -g wthbgp -n testvm2   > /dev/null 2>&1 & 
az vm start  -g wthbgp -n testvm3   > /dev/null 2>&1 & 
az vm start  -g wthbgp -n testvm4   > /dev/null 2>&1 & 
az vm start  -g wthbgp -n testvm5   > /dev/null 2>&1 & 
az vm start  -g wthbgp -n csr3-nva  > /dev/null 2>&1 & 
az vm start  -g wthbgp -n csr4-nva  > /dev/null 2>&1 & 
az vm start  -g wthbgp -n csr5-nva  > /dev/null 2>&1 & 

Stop Deallocate All VMs:
-------------------------
az vm deallocate -g wthbgp -n testvm1  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n testvm2  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n testvm3  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n testvm4  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n testvm5  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n csr3-nva  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n csr4-nva  > /dev/null 2>&1 & 
az vm deallocate -g wthbgp -n csr5-nva  > /dev/null 2>&1 & 

Check the status of VMSs:
-------------------------
az vm get-instance-view -g wthbgp -n testvm1    | grep -i power
az vm get-instance-view -g wthbgp -n  testvm2   | grep -i power
az vm get-instance-view -g wthbgp -n  testvm3   | grep -i power
az vm get-instance-view -g wthbgp -n  testvm4   | grep -i power
az vm get-instance-view -g wthbgp -n  testvm5   | grep -i power
az vm get-instance-view -g wthbgp -n  csr3-nva  | grep -i power
az vm get-instance-view -g wthbgp -n  csr4-nva  | grep -i power
az vm get-instance-view -g wthbgp -n  csr5-nva  | grep -i power

Connect to VMS:
---------------

cat ~/.ssh/id_rsa.pub returns the public key on the local VM.
Update local VM public key to Azure VM > Reset Passsword > SSH public Key source = use Existing key 

My public key is:
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCY12aVXmISdwgxsWUEw7AeUdSfl9db16/dMDDDkNlhBYDeNVALZD0NncYOa8Fa/l4GHN0+2jfPuUPnQtVJwdLXUynQuMmPOQ384jhe8VzV0vd3JZW8GAxf6EZVye50ZduWl7cX/vM9OyeuAcESSwC3tuSfk8WwTijW7nvczW1z5dDuAPq6ceO3MaPe5uBy3ZaC5xhvGfPAKdbKvNXTGbNOQ/QnVsAhYAWWVVkiOILtVqxqs/p+sEHsDGDM0a/o1Qjo/M8xHKEmsbfp8VyzmXATD455H/80tnmN6KwyzYZNIP/5DDscyEhthDqxJ/p9Qd1kb42DAFO6g6dSKLuufzAJ

Username/password for access is labadmin/supersecretPSK@123

export testvm1=$(az network public-ip show -n testvm1-ip -g wthbgp --query ipAddress -o tsv)
export testvm2=$(az network public-ip show -n testvm2-ip -g wthbgp --query ipAddress -o tsv)
export testvm3=$(az network public-ip show -n testvm3-ip -g wthbgp --query ipAddress -o tsv)
export testvm4=$(az network public-ip show -n testvm4-ip -g wthbgp --query ipAddress -o tsv)
export testvm5=$(az network public-ip show -n testvm5-ip -g wthbgp --query ipAddress -o tsv)
export csr3nva=$(az network public-ip show -n csr3-pip -g wthbgp --query ipAddress -o tsv)
export csr4nva=$(az network public-ip show -n csr4-pip -g wthbgp --query ipAddress -o tsv)
export csr5nva=$(az network public-ip show -n csr5-pip -g wthbgp --query ipAddress -o tsv)

Using SSH key: 
ssh labadmin@$testvm1
ssh labadmin@$testvm2
ssh labadmin@$testvm3
ssh labadmin@$testvm4
ssh labadmin@$testvm5
ssh labadmin@$csr3nva
ssh labadmin@$csr4nva
ssh labadmin@$csr5nva

Using Username Password:
ssh labadmin@$testvm1
supersecretPSK@123


FOR CSR-NVAs, access through serial console instead of SSH


Learnings:
-----------
with active/passive gateways 
    the next hop is the public IP of the VPN gateway, 
with active/active 
    the next hops are the private IPs (not that this is too important for this challenge):





    Not working:
    az network public-ip show -g $rg -n testvm3-pip
    az network public-ip show -g $rg -n testvm3-ip
    Working:
     az network public-ip show -g $rg -n testvm3-ip
